# Руководство по устранению неполадок: CloudBridge Relay Client

## Частые проблемы и решения

### 1. Ошибка TLS-рукопожатия
- **Проверьте**: Запущен ли relay-сервер и доступен ли он?
- **Проверьте**: Используется ли TLS 1.3 и корректные шифры?
- **Проверьте**: Верный ли путь к CA-сертификату в конфиге?
- **Проверьте**: Действителен ли сертификат сервера и не истёк ли он?

### 2. Ошибка аутентификации (`invalid_token`)
- **Проверьте**: Валиден ли JWT-токен (не истёк, корректная подпись)?
- **Проверьте**: Совпадает ли секрет JWT с сервером relay?
- **Проверьте**: Для Keycloak — корректны ли realm, client_id и JWKS endpoint?
- **Проверьте**: Есть ли в токене claim `sub`?

### 3. Превышен лимит запросов
- **Проверьте**: Не отправляете ли вы слишком много запросов в секунду?
- **Решение**: Подождите backoff и повторите попытку, либо увеличьте лимиты в конфиге (если вы управляете сервером).

### 4. Не удаётся создать туннель
- **Проверьте**: Валидны ли локальный и удалённый порты, не заняты ли они?
- **Проверьте**: Достижим ли удалённый хост с relay-сервера?
- **Проверьте**: Уникален ли tunnel_id?

### 5. Не работает heartbeat
- **Проверьте**: Живо ли соединение с relay-сервером?
- **Проверьте**: Нет ли сетевых задержек или проблем с фаерволом?

### 6. Неизвестный тип сообщения
- **Проверьте**: Используете ли вы совместимые версии клиента и сервера?
- **Проверьте**: Корректна ли версия протокола в hello-сообщении?

## Советы по отладке
- Запускайте с `--verbose` для подробного логирования.
- Проверяйте логи на коды ошибок и сообщения.
- Используйте `openssl s_client` для диагностики TLS.
- Проверяйте JWT-токены на [jwt.io](https://jwt.io/).
- Смотрите логи relay-сервера для подробностей.

## Получение помощи
- Изучите README и docs/README.md для конфигурации и примеров.
- Откройте issue на GitHub с логами и конфигом (не публикуйте секреты).
- По вопросам безопасности — контакты в основном README. 